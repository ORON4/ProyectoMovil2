<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProyectoMovil2.Views.GestionTareasPage"
             xmlns:viewmodels="clr-namespace:ProyectoMovil2.ViewModels"
             xmlns:models="clr-namespace:ProyectoMovil2.Models"
             x:DataType="viewmodels:GestionTareasViewModel"
             Title="Archivo de Tareas">

    <Grid RowDefinitions="Auto,*">

        <Button Grid.Row="0" Text="+ Crear Nueva Tarea Global" 
                Command="{Binding NuevaTareaCommand}"
                BackgroundColor="#28a745" TextColor="White" 
                Margin="20,10" CornerRadius="10"/>

        <RefreshView Grid.Row="1" IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding TareasGlobales}" EmptyView="No hay tareas registradas.">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Tarea">
                        <Frame Padding="15" Margin="10,5" CornerRadius="8" BorderColor="#CCC">
                            <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">

                                <VerticalStackLayout Grid.Row="0" Grid.Column="0" Spacing="2">
                                    <Label Text="{Binding Titulo}" FontSize="18" FontAttributes="Bold" TextColor="#333"/>
                                    <Label Text="{Binding FechaEntregaTexto, StringFormat='ðŸ“… {0}'}" TextColor="#666" FontSize="13"/>
                                </VerticalStackLayout>

                                <HorizontalStackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                                                       Spacing="15" Margin="0,10,0,0" HorizontalOptions="End">

                                    <Button Text="âœï¸ Editar" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:GestionTareasViewModel}}, Path=EditarCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#ffc107" TextColor="Black" 
                                            HeightRequest="35" FontSize="12" Padding="10,0"/>

                                    <Button Text="ðŸ—‘ï¸ Eliminar Todo" 
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:GestionTareasViewModel}}, Path=EliminarCommand}"
                                            CommandParameter="{Binding .}"
                                            BackgroundColor="#dc3545" TextColor="White"
                                            HeightRequest="35" FontSize="12" Padding="10,0"/>
                                </HorizontalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>