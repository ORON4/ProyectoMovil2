<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ProyectoMovil2.Views.TareasPage"
             xmlns:viewmodels="clr-namespace:ProyectoMovil2.ViewModels"
             xmlns:models="clr-namespace:ProyectoMovil2.Models"
             x:DataType="viewmodels:TareasViewModel"
             Title="Lista de Alumnos">

    <Grid RowDefinitions="Auto,*" Padding="0">

        <VerticalStackLayout Grid.Row="0" Padding="20" Spacing="10" BackgroundColor="#007ACC">
            <Label Text="Asignar Tareas" FontSize="24" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
            <Label Text="Selecciona un alumno para ver sus tareas" FontSize="14" TextColor="#E0E0E0" HorizontalOptions="Center"/>

            <Button Text="+ Nueva Tarea Global"
                    Command="{Binding CrearTareaCommand}"
                    BackgroundColor="#28a745"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="45"
                    Margin="0,10,0,0"/>
        </VerticalStackLayout>

        <RefreshView Grid.Row="1" IsRefreshing="{Binding IsRefreshing}" Command="{Binding RefreshCommand}">
            <CollectionView ItemsSource="{Binding Alumnos}" 
                            SelectionMode="None"
                            EmptyView="No hay alumnos cargados">

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:Alumno">
                        <Frame Padding="15" Margin="10,5" CornerRadius="10" BorderColor="#DDDDDD" HasShadow="True">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:TareasViewModel}}, Path=IrAAlumnoCommand}"
                                    CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>

                            <Grid ColumnDefinitions="Auto, *">
                                <Label Grid.Column="0" Text="ðŸ‘¤" FontSize="24" VerticalOptions="Center" Margin="0,0,15,0"/>

                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                    <Label Text="{Binding NombreAlumno}" FontSize="18" FontAttributes="Bold" TextColor="#333"/>
                                    <Label Text="{Binding Grupo, StringFormat='Grupo: {0}'}" FontSize="14" TextColor="#666"/>
                                </VerticalStackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <ActivityIndicator Grid.Row="1" IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                           HorizontalOptions="Center" VerticalOptions="Center" Color="#007ACC"/>

        <Label Grid.Row="1" Text="{Binding MensajeError}" IsVisible="{Binding MensajeError, Converter={StaticResource StringNotEmptyConverter}}"
               TextColor="Red" HorizontalOptions="Center" VerticalOptions="Center"/>
    </Grid>
</ContentPage>